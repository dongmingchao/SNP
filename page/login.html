<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>云盘</title>
    <!--<link rel="stylesheet" type="text/css" href="css/login.css"/>-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.bootcss.com/foundation/5.5.3/css/foundation.min.css">
</head>
<style>
    .side-nav > li{
        font-size: 1.5rem;
    }
</style>
<body>
<nav class="top-bar" data-topbar>
    <ul class="title-area">
        <li class="name">
            <h1><a href="#">网盘范例</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>

    <section class="top-bar-section">
        <ul class="left">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#">Page 1</a></li>
            <li><a href="#">Page 2</a></li>
            <li><a href="#">Page 3</a></li>
        </ul>
    </section>
</nav>
<div class="medium-2 columns" style="background-color:#f1f1f1;">
    <ul class="side-nav" style="font-size: large">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#">全部文件</a></li>
        <li><a href="#">图片</a></li>
        <li><a href="#">文档</a></li>
        <li><a href="#">视频</a></li>
        <li><a href="#">音乐</a></li>
        <li><a href="#">其他</a></li>
    </ul>
</div>
<table class="medium-10">
    <thead>
    <tr>
        <th>
            <input type="checkbox" id="j_cbAll"/>
        </th>
        <th>文件名</th>
        <th>大小</th>
        <th>修改日期</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody id="fileList"></tbody>
</table>

</body>
<script src="js/jquery.js"></script>
<script src="https://cdn.bootcss.com/foundation/5.5.3/js/foundation.min.js"></script>
<script src="https://cdn.bootcss.com/foundation/5.5.3/js/vendor/modernizr.js"></script>
<script>
    let xhr = new XMLHttpRequest();
    xhr.open("get", "/file", true);
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.status === 200 && xhr.readyState === 4) {
            let rec = JSON.parse(xhr.responseText);
            for (let i = 0; i < rec.length; i++) {
                let each = rec[i].split('/');
                if (!each[1]) each[1] = "..";
                let ch = $('<tr>');
                let swit = $('<div class="switch small">');
                swit.append($('<input type="checkbox" id="'+i+'">'));
                swit.append($('<label for="'+i+'">'));
                ch.append($('<td>').append(swit));
                ch.append($('<td>').append($('<a href="#" onclick=kick(\'' + rec[i] + '\')>').text(each[1])));
                ch.append($('<td>').text('10kb'));
                ch.append($('<td>').text('2018.1.23'));
                let toolbar = $('<ul class="button-group">');
                toolbar.append($('<li>').append($('<button type="button" class="button small" onclick="window.location.href='+rec[i]+'">').text('下载')));
                toolbar.append($('<li>').append($('<button type="button" class="button small" onclick="window.location.href='+rec[i]+'">').text('查看')));
                toolbar.append($('<li>').append($('<button type="button" class="button small" onclick="window.location.href='+rec[i]+'">').text('复制')));
                toolbar.append($('<li>').append($('<button type="button" class="button small" onclick="window.location.href='+rec[i]+'">').text('详细信息')));
                ch.append(toolbar);
                $('#fileList').append(ch);
            }
        }
    };

    function kick(item) {
        console.log(item);
        if (!item.split('.')[1]) cd(item);
    }

    function cd(directory) {
        $('#fileList').empty();
        let stepIn = new XMLHttpRequest();
        stepIn.open("get", "/find?dirName=" + directory, true);
        stepIn.send();
        stepIn.onreadystatechange = () => {
            if (stepIn.status === 200 && stepIn.readyState === 4) {
                for (let i = 0; i < rec.length; i++) {
                    let ch = $('<tr>');
                    ch.append($('<td>').append($('<input type="checkbox">')));
                    ch.append($('<td>').append($('<a href="#" onclick=kick(\'' + rec[i] + '\')>').text(each[1])));
                    ch.append($('<td>').text('10kb'));
                    ch.append($('<td>').text('2018.1.23'));
                    ch.append($('<a href=' + rec[i] + ' download=' + rec[i] + '>').text('下载'));
                    $('#fileList').append(ch);
                }
            }
        }
    }
</script>
</html>
